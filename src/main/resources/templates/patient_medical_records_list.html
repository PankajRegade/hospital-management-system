<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title th:text="${patientName != null ? patientName + ' · Medical Records' : 'My Medical Records'}">Medical Records</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f6f8fb;padding:24px;color:#1f2937}
    .container{max-width:1000px;margin:0 auto}
    .card{background:#fff;padding:18px;border-radius:8px;box-shadow:0 6px 20px rgba(15,23,36,0.06)}
    h1{margin-bottom:10px}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px;border-bottom:1px solid #eef2f6;text-align:left}
    .btn{display:inline-block;padding:8px 12px;background:#667eea;color:#fff;border-radius:8px;text-decoration:none}
    .small{color:#64748b;font-size:13px}
  </style>
</head>
<body>
  <div class="container">
    <a th:href="@{/patient}" class="btn">← Back to Dashboard</a>
    <div style="height:12px"></div>

    <div class="card">
      <h1>Medical Records</h1>
      <p class="small" th:text="${patientName != null ? 'Patient: ' + patientName : ''}"></p>

      <div th:if="${records == null or #lists.isEmpty(records)}" style="padding:22px;color:#64748b;border-radius:8px;border:1px dashed #e6eef8">
        No medical records found.
      </div>

      <div th:if="${records != null and !#lists.isEmpty(records)}">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Date</th>
              <th>Doctor</th>
              <th>Diagnosis (snippet)</th>
              <th>Attachments</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="r : ${records}">
              <td th:text="${r.id}">1</td>
              <td th:text="${r.recordDate != null ? #dates.format(r.recordDate,'dd MMM yyyy') : '-'}">02 Dec 2025</td>
              <td th:text="${r.doctor != null ? r.doctor.name : '-'}">Dr X</td>
              <td th:text="${r.diagnosis != null ? (r.diagnosis.length() > 80 ? r.diagnosis.substring(0,80) + '...' : r.diagnosis) : '-'}"></td>
              <td>
                <span th:if="${r.reports != null and !#lists.isEmpty(r.reports)}" th:each="rep : ${r.reports}">
                  <a th:href="@{'/records/files/' + ${rep.id}}" th:text="${rep.originalName}">file.pdf</a><br/>
                </span>
                <span th:if="${r.reports == null or #lists.isEmpty(r.reports)}" class="small">—</span>
              </td>
              <td><a th:href="@{'/patient/records/' + ${r.id}}" class="btn">View</a></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
