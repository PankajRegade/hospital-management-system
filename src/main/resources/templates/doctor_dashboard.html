<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctor Dashboard | Nexus Health</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* --- Modern Reset & Variables --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --accent-sky: #0284c7;
      --accent-blue: #38bdf8;
      --bg-brand-red: #ef4444;
      --card-bg: rgba(255, 255, 255, 0.45);
      --text-main: #0f172a;
      --text-dim: #334155;
      --transition: all 0.4s cubic-bezier(.16, 1, .3, 1);
      --glass-shadow: 0 8px 22px rgba(0, 0, 0, 0.18);
    }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      /* Flipped Background: Blue to Orange/Red */
      background: linear-gradient(135deg, #38bdf8 0%, #ef4444 65%, #fb7185 100%);
      min-height: 100vh;
      color: var(--text-main);
      overflow-x: hidden;
      position: relative;
    }

    /* --- Graphical Background Layers --- */
    .bg-graphical {
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
    }

    /* Subtle Grid Pattern */
    .bg-grid {
      position: absolute;
      inset: 0;
      background-image: 
        linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* Dotted Pattern Overlay */
    .bg-dots {
      position: absolute;
      inset: 0;
      background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    .bg-blobs {
      position: fixed;
      inset: 0;
      z-index: -1;
      filter: blur(55px);
      opacity: 0.55;
    }
    .blob {
      position: absolute;
      border-radius: 50%;
      animation: morph 20s infinite alternate ease-in-out;
    }
    .blob-1 { width: 420px; height: 420px; background: #38bdf8; top: -120px; left: -120px; }
    .blob-2 { width: 400px; height: 400px; background: #fb7185; bottom: -120px; right: -120px; animation-delay: -4s; }
    .blob-3 { width: 350px; height: 350px; background: #f472b6; top: 40%; left: 35%; animation-duration: 30s; }

    @keyframes morph {
      0% { transform: scale(1) translate(0, 0) rotate(0deg); border-radius: 50%; }
      33% { transform: scale(1.1) translate(30px, -20px) rotate(10deg); border-radius: 40% 60% 70% 30% / 40% 50% 60% 70%; }
      100% { transform: scale(0.9) translate(-20px, 30px) rotate(-10deg); border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
    }

    .container {
      max-width: 1120px;
      margin: auto;
      padding: 1.5rem;
    }

    /* --- Entry Animations --- */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(30px); }
      to { opacity: 1; transform: translateX(0); }
    }

    /* --- Header --- */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      background: rgba(255, 255, 255, 0.55);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      box-shadow: var(--glass-shadow);
      margin-bottom: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      animation: fadeInUp 0.8s cubic-bezier(.16, 1, .3, 1);
    }

    .doctor-profile-brand {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .avatar-ring {
      padding: 3px;
      border-radius: 50%;
      border: 2px solid #000;
      background: linear-gradient(45deg, var(--accent-blue), #fff, #ef4444);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }
    .avatar-ring:hover { transform: rotate(15deg) scale(1.08); }

    .doctor-avatar {
      width: 50px; height: 50px;
      border-radius: 50%;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .doctor-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .doctor-avatar i { color: var(--accent-sky); font-size: 1.2rem; }

    .header-info {
      padding: 0.5rem 1.25rem;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.8);
      animation: floatSubtle 5s infinite alternate ease-in-out;
      transition: var(--transition);
    }
    .header-info:hover { background: rgba(255, 255, 255, 0.85); transform: translateY(-3px); }

    @keyframes floatSubtle {
      from { transform: translateY(0); }
      to { transform: translateY(-5px); }
    }

    .header-info h1 {
      font-size: 1.2rem;
      font-weight: 800;
      color: var(--accent-sky);
      margin-bottom: 2px;
    }
    #current-time {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--text-dim);
    }

    /* --- Grid --- */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 1.5rem;
    }
    @media (max-width: 1000px) { .dashboard-grid { grid-template-columns: 1fr; } }

    .main-section { animation: slideInLeft 0.8s cubic-bezier(.16, 1, .3, 1) 0.1s both; }
    .sidebar-section { animation: slideInRight 0.8s cubic-bezier(.16, 1, .3, 1) 0.2s both; }

    /* --- Card --- */
    .card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 22px;
      padding: 1.5rem;
      box-shadow: var(--glass-shadow);
      transition: var(--transition);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .card:hover { 
      transform: translateY(-5px); 
      box-shadow: 0 15px 35px rgba(0,0,0,0.2);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .card-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.25rem;
    }
    .card-title h3 {
      font-size: 1rem;
      font-weight: 800;
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .icon-box {
      width: 34px; height: 34px;
      border-radius: 10px;
      background: rgba(2, 132, 199, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent-sky);
      transition: var(--transition);
    }
    .card:hover .icon-box { transform: scale(1.1) rotate(5deg); background: rgba(2, 132, 199, 0.2); }

    /* --- Table --- */
    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
    th {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-dim);
      padding: 0 0.75rem 0.5rem;
      text-align: left;
    }
    tbody tr {
      background: rgba(255, 255, 255, 0.3);
      transition: var(--transition);
      opacity: 0;
      transform: translateY(15px);
    }
    tbody tr.visible { opacity: 1; transform: translateY(0); }
    tbody tr:hover { 
      background: rgba(255, 255, 255, 0.65); 
      transform: scale(1.01) translateX(5px);
    }

    td { padding: 0.75rem; font-size: 0.85rem; }

    .patient-cell { display: flex; align-items: center; gap: 0.75rem; }
    .avatar-sm {
      width: 36px; height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent-sky), #0369a1);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      box-shadow: 0 4px 10px rgba(2, 132, 199, 0.2);
    }

    .name-badge-box {
      background: rgba(255, 255, 255, 0.5);
      padding: 0.35rem 0.75rem;
      border-radius: 10px;
      line-height: 1.2;
      transition: var(--transition);
    }
    tr:hover .name-badge-box { background: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

    /* --- Buttons --- */
    .btn-action {
      padding: 0.5rem 1rem;
      border-radius: 10px;
      font-size: 0.75rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-sky), #0369a1);
      color: #fff;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      border: none;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }
    .btn-action:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(2, 132, 199, 0.4); }
    .btn-action::after {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    .btn-action:hover::after { left: 100%; }

    .btn-outline {
      background: transparent;
      color: var(--accent-sky);
      border: 1px solid rgba(2, 132, 199, 0.4);
    }
    .btn-outline:hover { background: #fff; color: #0369a1; }

    .logout-btn { background: #000; }
    .logout-btn:hover { background: #1e293b; transform: scale(1.05); }

    /* --- Status Badge --- */
    .status-badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.65rem;
      font-weight: 800;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .status-badge.approved {
      background: rgba(22, 101, 52, 0.95);
      color: #ecfdf5;
      border: 1px solid rgba(22, 101, 52, 1);
      box-shadow: 0 6px 16px rgba(22, 101, 52, 0.3);
      animation: pulseGreen 3s infinite;
    }

    @keyframes pulseGreen {
      0% { box-shadow: 0 0 0 0 rgba(22, 101, 52, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(22, 101, 52, 0); }
      100% { box-shadow: 0 0 0 0 rgba(22, 101, 52, 0); }
    }

    /* --- Sidebar Info --- */
    .info-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 14px;
      margin-bottom: 0.75rem;
      transition: var(--transition);
      text-decoration: none;
      color: inherit;
      border: 1px solid transparent;
    }
    .info-item:hover { 
      background: rgba(255, 255, 255, 0.8); 
      border-color: rgba(255, 255, 255, 0.9); 
      transform: translateX(8px); 
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.15); border-radius: 10px; }
  </style>
</head>

<body>

<div class="bg-graphical">
  <div class="bg-grid"></div>
  <div class="bg-dots"></div>
</div>

<div class="bg-blobs">
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>
  <div class="blob blob-3"></div>
</div>

<div class="container">

  <!-- HEADER -->
  <header class="header">
    <div class="doctor-profile-brand">
      <div class="avatar-ring">
        <div class="doctor-avatar">
          <img th:if="${doctor?.photoPath}" th:src="@{${doctor.photoPath}}" alt="Doctor"/>
          <i th:unless="${doctor?.photoPath}" class="fas fa-user-md"></i>
        </div>
      </div>
      <div class="header-info">
        <h1 th:text="'Dr. ' + ${doctorName}">Dr. Alexander Reed</h1>
        <div id="current-time">Connecting...</div>
      </div>
    </div>

    <a th:href="@{/logoutPage}" class="btn-action logout-btn">
      <i class="fas fa-sign-out-alt"></i> Logout
    </a>
  </header>

  <!-- DASHBOARD GRID -->
  <div class="dashboard-grid">

    <!-- APPOINTMENTS LIST -->
    <section class="main-section">
      <div class="card">
        <div class="card-title">
          <h3><div class="icon-box"><i class="fas fa-calendar-alt"></i></div>Upcoming Appointments</h3>
          <a th:href="@{/doctor/appointments/manage}" class="btn-action" style="font-size: 0.7rem;">Manage</a>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Patient</th>
                <th>Time</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="appointment-body">
              <!-- Thymeleaf loop -->
              <tr th:each="a : ${appointments}">
                <td>
                  <div class="patient-cell">
                    <div class="avatar-sm" th:text="${a.patient != null ? #strings.substring(a.patient.name,0,1) : 'P'}">P</div>
                    <div class="name-badge-box">
                      <strong th:text="${a.patient?.name}">James Wilson</strong><br>
                      <small>ID: #<span th:text="${a.id}">102</span></small>
                    </div>
                  </div>
                </td>
                <td>
                  <div style="font-weight: 700; color: var(--text-dim);">
                    <i class="far fa-clock" style="margin-right: 5px; color: var(--accent-sky);"></i>
                    <span th:text="${a.appointmentTime}">10:30 AM</span>
                  </div>
                </td>
                <td>
                  <div style="display: flex; gap: 0.5rem;">
                    <a class="btn-action" th:href="@{'/doctor/records/new'(appointmentId=${a.id})}">
                      <i class="fas fa-plus"></i> Record
                    </a>
                    <a class="btn-action btn-outline" th:href="@{'/doctor/appointments/' + ${a.id}}">
                      <i class="fas fa-eye"></i>
                    </a>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SIDEBAR -->
    <aside class="sidebar-section">
      <!-- Profile Summary -->
      <div class="card">
        <div class="card-title">
          <h3><div class="icon-box"><i class="fas fa-user-circle"></i></div>Profile Details</h3>
          <a th:href="@{/doctor/details}" style="color: var(--accent-sky);"><i class="fas fa-user-edit"></i></a>
        </div>

        <div class="info-item">
          <div class="icon-box" style="width: 30px; height: 30px; font-size: 0.8rem;"><i class="fas fa-briefcase-medical"></i></div>
          <div>
            <small style="font-size: 0.65rem; text-transform: uppercase; color: #64748b; font-weight: 800;">Specialization</small><br>
            <strong style="font-size: 0.85rem;" th:text="${doctor?.specialization ?: 'General Medicine'}">Cardiology</strong>
          </div>
        </div>

        <div class="info-item">
          <div class="icon-box" style="width: 30px; height: 30px; font-size: 0.8rem;"><i class="fas fa-at"></i></div>
          <div>
            <small style="font-size: 0.65rem; text-transform: uppercase; color: #64748b; font-weight: 800;">Email</small><br>
            <strong style="font-size: 0.85rem;" th:text="${doctor?.email ?: 'Not Set'}">doctor@nexus.com</strong>
          </div>
        </div>

        <div class="info-item" style="background: rgba(34, 197, 94, 0.12); border-color: rgba(34, 197, 94, 0.2);">
          <div class="icon-box" style="width: 30px; height: 30px; color: #166534; background: rgba(34, 197, 94, 0.2);"><i class="fas fa-shield-check"></i></div>
          <div>
            <small style="font-size: 0.65rem; text-transform: uppercase; color: #166534; font-weight: 800;">Status</small><br>
            <span th:if="${doctor?.approved}" class="status-badge approved">
              <i class="fas fa-check-circle"></i> Verified
            </span>
            <span th:unless="${doctor?.approved}" class="status-badge" style="background: white; border: 1px solid #991b1b; color: #991b1b;">
              Pending
            </span>
          </div>
        </div>
      </div>

      <!-- Quick Access -->
      <div class="card" style="margin-top: 1.5rem">
        <div class="card-title">
          <h3><div class="icon-box"><i class="fas fa-bolt"></i></div>Quick Access</h3>
        </div>

        <a th:href="@{/doctor/records}" class="info-item">
          <div style="flex: 1;">
            <strong style="font-size: 0.85rem;">Medical Records</strong><br>
            <small style="font-size: 0.65rem; color: #64748b;">View patient history</small>
          </div>
          <i class="fas fa-chevron-right" style="opacity: 0.3;"></i>
        </a>

        <a th:href="@{/doctor/records/new}" class="info-item" style="margin-bottom: 0;">
          <div style="flex: 1;">
            <strong style="font-size: 0.85rem;">New Entry</strong><br>
            <small style="font-size: 0.65rem; color: #64748b;">Create report</small>
          </div>
          <i class="fas fa-file-medical" style="color: var(--accent-sky);"></i>
        </a>
      </div>
    </aside>

  </div>
</div>

<script>
  // Update Time Formatting
  function updateTime(){
    const now = new Date();
    const options = {
      weekday: 'long',
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: true
    };
    // Format: Wednesday, Dec 17, 2025 • 10:30:15 PM
    document.getElementById("current-time").innerText =
      now.toLocaleString('en-US', options).replace(',', ' •');
  }

  updateTime();
  setInterval(updateTime, 1000);

  // Staggered Table Row Animation with enhanced visibility
  window.addEventListener('DOMContentLoaded', () => {
    const rows = document.querySelectorAll('tbody tr');
    rows.forEach((row, index) => {
      setTimeout(() => {
        row.classList.add('visible');
      }, 150 * (index + 1));
    });
  });

  // Card Parallax/Glow logic with smoother easing
  document.querySelectorAll('.card').forEach(card => {
    card.addEventListener('mousemove', (e) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      card.style.setProperty('--mouse-x', `${x}px`);
      card.style.setProperty('--mouse-y', `${y}px`);
    });
    
    card.addEventListener('mouseleave', () => {
      card.style.transition = 'all 0.5s ease';
    });
  });
</script>

</body>
</html>