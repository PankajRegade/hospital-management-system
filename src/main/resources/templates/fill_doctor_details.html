<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Doctor Profile | Nexus Health</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<style>
*{margin:0;padding:0;box-sizing:border-box}

:root{
  --primary-blue:#38bdf8;
  --primary-fuchsia:#d946ef;
  --danger:#f87171;
  --bg-deep:#0b1121;
  --card-bg:rgba(15,23,42,.85);
  --card-border:rgba(255,255,255,.08);
  --input-bg:rgba(30,41,59,.55);
  --text-white:#fff;
  --text-dim:#94a3b8;
  --transition:all .45s cubic-bezier(.2,.8,.2,1);
  --glow-shadow:0 15px 45px -15px rgba(56,189,248,.35);
}

body{
  font-family:'Plus Jakarta Sans',sans-serif;
  background:var(--bg-deep);
  background-image:
    radial-gradient(circle at 15% 15%,rgba(14,165,233,.15),transparent 50%),
    radial-gradient(circle at 85% 85%,rgba(131,24,67,.25),transparent 50%);
  color:var(--text-white);
  min-height:100vh;
  padding:1.5rem;
}

/* background */
.bg-blobs{position:fixed;inset:0;z-index:-1;filter:blur(90px);opacity:.6}
.blob{position:absolute;border-radius:50%;animation:float 18s infinite alternate}
.blob-1{width:480px;height:480px;background:#0284c7;top:-120px;left:-120px}
.blob-2{width:380px;height:380px;background:#be185d;bottom:-80px;right:-80px;animation-delay:-5s}

@keyframes float{
  0%{transform:translate(0,0)}
  50%{transform:translate(30px,20px)}
  100%{transform:translate(-20px,40px)}
}

.container{max-width:820px;margin:auto}

/* header */
.navbar{
  display:flex;justify-content:space-between;align-items:center;
  padding:1.25rem 2rem;
  background:var(--card-bg);
  backdrop-filter:blur(25px);
  border:1px solid var(--card-border);
  border-radius:24px;
  margin-bottom:2.5rem;
  box-shadow:var(--glow-shadow);
}
.brand{display:flex;align-items:center;gap:12px;font-size:1.25rem;font-weight:800}
.brand i{color:var(--primary-blue)}
.back-link{
  color:var(--text-dim);text-decoration:none;font-weight:600;
  display:flex;gap:8px;align-items:center;transition:var(--transition);
}
.back-link:hover{color:var(--primary-blue)}

/* page header */
.page-header{text-align:center;margin-bottom:2.5rem}
.page-title{
  font-size:2rem;font-weight:800;
  background:linear-gradient(135deg,#fff,#94a3b8);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.page-subtitle{color:var(--text-dim);margin-top:6px}

/* card */
.card{
  background:var(--card-bg); backdrop-filter:blur(22px);
  border:1px solid var(--card-border); border-radius:32px;
  padding:3rem; box-shadow:var(--glow-shadow); position:relative;
}
.card::before{
  content:''; position:absolute;top:0;left:0;width:100%;height:2px;
  background:linear-gradient(90deg,transparent,#38bdf8,#f472b6,transparent); opacity:.6;
}

/* alert */
.alert{
  background:rgba(16,185,129,.12); border:1px solid rgba(16,185,129,.35);
  color:#34d399; padding:16px; border-radius:16px;
  text-align:center; margin-bottom:24px;
}

/* avatar */
.upload-section{text-align:center;margin-bottom:3rem}

.avatar-preview{
  width:140px;height:140px; border-radius:50%; padding:3px;
  background:linear-gradient(135deg,var(--primary-fuchsia),var(--primary-blue));
  box-shadow:0 0 35px rgba(56,189,248,.35); margin:auto;
  transition:var(--transition);
}
.avatar-preview:hover{transform:scale(1.05)}

.avatar-inner{
  width:100%;height:100%; border-radius:50%;
  background:#020617; display:flex;align-items:center;justify-content:center;
  overflow:hidden;
}
.profile-img{width:100%;height:100%;object-fit:cover;display:none}
.profile-icon{font-size:3.5rem;color:rgba(255,255,255,.18)}

.photo-actions{
  margin-top:18px; display:flex; justify-content:center; gap:12px; flex-wrap:wrap;
}

.btn-upload{
  padding:.7rem 1.6rem; border-radius:50px; font-weight:700;
  border:1px solid rgba(255,255,255,.2); background:transparent;
  color:#fff; cursor:pointer; display:inline-flex;gap:8px;align-items:center;
  transition:var(--transition);
}
.btn-upload:hover{background:#38bdf8;border-color:#38bdf8;}
.btn-remove{border-color:rgba(248,113,113,.4);color:var(--danger);}
.btn-remove:hover{background:var(--danger);border-color:var(--danger);color:#000;}

/* form */
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px}
.form-group{margin-bottom:24px}
.form-label{
  font-size:.7rem;text-transform:uppercase;letter-spacing:1px;
  color:var(--text-dim);font-weight:800;margin-bottom:8px;
}
.input-wrapper{position:relative}
.input-icon{
  position:absolute;left:16px;top:50%;
  transform:translateY(-50%);color:var(--primary-blue);
}
.form-control{
  width:100%;background:var(--input-bg); border:1px solid var(--card-border);
  padding:14px 16px 14px 48px; border-radius:16px;color:#fff;font-size:1rem;
}
.form-control:focus{
  outline:none;border-color:#38bdf8;
  background:rgba(56,189,248,.12); box-shadow:0 0 0 3px rgba(56,189,248,.15);
}

/* actions */
.form-actions{
  margin-top:2.5rem;padding-top:1.5rem;
  border-top:1px solid var(--card-border);
  display:flex;justify-content:flex-end;gap:16px;
}
.btn{padding:.8rem 2.2rem;border-radius:16px;font-weight:800;border:none;cursor:pointer}
.btn-primary{background:#fff;color:#020617}
.btn-primary:hover{background:#38bdf8;color:#fff;box-shadow:0 10px 30px rgba(56,189,248,.45)}
.btn-ghost{background:transparent;color:var(--text-dim)}
.btn-ghost:hover{color:#fff}

@media(max-width:600px){.form-grid{grid-template-columns:1fr}}
</style>
</head>

<body>

<div class="bg-blobs">
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>
</div>

<div class="container">

<nav class="navbar">
  <div class="brand"><i class="fas fa-hospital"></i> AXES Hospital</div>
  <a href="#" onclick="history.back()" class="back-link">
    <i class="fas fa-arrow-left"></i> Go Back
  </a>
</nav>

<header class="page-header">
  <h1 class="page-title">Doctor Profile</h1>
  <p class="page-subtitle">Complete your professional details to get verified</p>
</header>

<div th:if="${msg}" class="alert" th:text="${msg}"></div>

<div class="card">
<form th:action="@{/doctor/details}" method="post" enctype="multipart/form-data">

<input type="hidden" name="id" th:value="${doctor.id}">

<input type="hidden" name="removePhoto" id="removePhotoFlag" value="false">

<div class="upload-section">
  <div class="avatar-preview">
    <div class="avatar-inner">
      <img id="previewImage" class="profile-img"
           th:src="@{${doctor.photoPath}}"
           th:style="${doctor.photoPath != null} ? 'display:block' : 'display:none'">
      <i id="defaultIcon" class="fas fa-user-md profile-icon"
         th:style="${doctor.photoPath != null} ? 'display:none' : 'display:block'"></i>
    </div>
  </div>

  <div class="photo-actions">
    <label class="btn-upload">
      <i class="fas fa-camera"></i> Change Photo
      <input type="file" name="imageFile" id="imageFile" hidden accept="image/*" onchange="previewFile()">
    </label>

    <button type="button"
            id="removeBtn"
            class="btn-upload btn-remove"
            th:style="${doctor.photoPath == null} ? 'display:none' : 'display:inline-flex'"
            onclick="clearPhoto()">
      <i class="fas fa-trash"></i> Remove Photo
    </button>
  </div>
</div>

<div class="form-grid">
  <div class="form-group">
    <label class="form-label">Full Name</label>
    <div class="input-wrapper">
      <i class="fas fa-user input-icon"></i>
      <input type="text" name="name" class="form-control" th:value="${doctor.name}" required>
    </div>
  </div>

  <div class="form-group">
    <label class="form-label">Specialization</label>
    <div class="input-wrapper">
      <i class="fas fa-stethoscope input-icon"></i>
      <input type="text" name="specialization" class="form-control" th:value="${doctor.specialization}" required>
    </div>
  </div>
</div>

<div class="form-group">
  <label class="form-label">Phone Number</label>
  <div class="input-wrapper">
    <i class="fas fa-phone-alt input-icon"></i>
    <input type="text" name="phone" class="form-control" th:value="${doctor.phone}">
  </div>
</div>

<div class="form-actions">
  <button type="button" class="btn btn-ghost" onclick="history.back()">Cancel</button>
  <button type="submit" class="btn btn-primary">Save Profile</button>
</div>

</form>
</div>

</div>

<script>
function previewFile(){
  const img = document.getElementById('previewImage');
  const icon = document.getElementById('defaultIcon');
  const removeFlag = document.getElementById('removePhotoFlag');
  const removeBtn = document.getElementById('removeBtn');
  const file = document.getElementById('imageFile').files[0];
  const reader = new FileReader();

  reader.onload = () => {
    img.src = reader.result;
    img.style.display = 'block';
    icon.style.display = 'none';
    
    // Reset remove flag because we have a NEW image
    removeFlag.value = 'false';
    // Show the remove button
    removeBtn.style.display = 'inline-flex';
  };
  if(file) reader.readAsDataURL(file);
}

function clearPhoto(){
  const img = document.getElementById('previewImage');
  const icon = document.getElementById('defaultIcon');
  const removeFlag = document.getElementById('removePhotoFlag');
  const fileInput = document.getElementById('imageFile');
  const removeBtn = document.getElementById('removeBtn');

  // Hide image, show default icon
  img.src = '';
  img.style.display = 'none';
  icon.style.display = 'block';

  // Clear input and Set Flag to TRUE
  fileInput.value = '';
  removeFlag.value = 'true';
  
  // Hide remove button
  removeBtn.style.display = 'none';
}
</script>

</body>
</html>